<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/calendar.css">
  <title>Document</title>
</head>

<body>
  <div class="calendar">
    <div class="title">
      <button class="cal_Lbtn" onclick="prevMonth()">&lt;</button>
      <div class="ym">
        <div class="year"></div>
        <div class="month"></div>
        <div class="monthtxt"></div>
      </div>
      <button class="cal_Rbtn" onclick="nextMonth()">&gt;</button>
    </div>
    <div class="main">
      <div class="days">
        <div class="day">S</div>
        <div class="day">M</div>
        <div class="day">T</div>
        <div class="day">W</div>
        <div class="day">T</div>
        <div class="day">F</div>
        <div class="day">S</div>
      </div>
      <div class="dates"></div>
    </div>
  </div>
  <div class="diary">
    <span class="today"></span>
    <button class="plus_btn"></button>
    <div class="schedules">
      <ul class="schedules_list">
        <li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li>
        <li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속dddddddddddddddd</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li>
        <li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속dddddddddddddddd</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li><li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속dddddddddddddddd</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li><li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속dddddddddddddddd</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li><li>
          <div class="schedule">
            <div class="schedule_color"></div>
            <p class="schedule_time">19:00~21:00</p>
            <p class="schedule_info">저녁 약속dddddddddddddddd</p>
            <div class="schedule_edit">수정</div>
            <div class="schedule_delete">삭제</div>
          </div>
          <div class="schedule_underline"></div>
        </li>

      </ul>
    </div>

  </div>

  <div class="popup_add_date">
    <h4>일정</h4>
    <form class="add_date" action="" method="get">
      <fieldset class="name">
        <div class="color_box">
          <input type="radio" id="color1" name="color" value="color1" checked>
          <label for="color1" class="color1" ></label>
          <input type="radio" id="color2" name="color" value="color2">
          <label for="color2" class="color2" ></label>
          <input type="radio" id="color3" name="color" value="color3">
          <label for="color3" class="color3" ></label>
          <input type="radio" id="color4" name="color" value="color4">
          <label for="color4" class="color4" ></label>
        </div>
        <input type="text" name="" id="" placeholder="일정 이름 입력">
      </fieldset>
      <fieldset class="date">
        <input type="date" name="start_date" id="start_date"> ~
        <input type="date" name="last_date" id="last_date">
      </fieldset>
      <fieldset class="time">
        <input type="checkbox" id="allday" name="종일">
        <label for="allday">종일</label>
        <input type="time" name="start_time" id="start_time"> ~
        <input type="time" name="last_time" id="last_time">
      </fieldset>
      <fieldset class="day">
        <input type="checkbox" id="mon" name="월">
        <label for="mon">월</label>
        <input type="checkbox" id="tue" name="화">
        <label for="tue">화</label>
        <input type="checkbox" id="wed" name="수">
        <label for="wed">수</label>
        <input type="checkbox" id="thu" name="목">
        <label for="thu">목</label>
        <input type="checkbox" id="fri" name="금">
        <label for="fri">금</label>
        <input type="checkbox" id="sat" name="토">
        <label for="sat">토</label>
        <input type="checkbox" id="sun" name="일">
        <label for="sun">일</label>
      </fieldset>
      <fieldset class="add_date_btn">
        <button type="submit">확인</button>
        <button>취소</button>
      </fieldset>
    </form>
    
  </div>
<script>
  let date = new Date();
let dateDivs = document.querySelectorAll(".date");
const whatDay = function (day) {
  if (day == 0) return "일";
  else if (day == 1) return "월";
  else if (day == 2) return "화";
  else if (day == 3) return "수";
  else if (day == 4) return "목";
  else if (day == 5) return "금";
  else if (day == 6) return "토";
};

const calendar = function () {
  //년, 월 계산
  const year = date.getFullYear() + "";
  const month = date.getMonth();
  const monthtxt = function () {
    if (month == 0) return "January";
    else if (month == 1) return "February";
    else if (month == 2) return "March";
    else if (month == 3) return "April";
    else if (month == 4) return "May";
    else if (month == 5) return "June";
    else if (month == 6) return "July";
    else if (month == 7) return "August";
    else if (month == 8) return "September";
    else if (month == 9) return "October";
    else if (month == 10) return "November";
    else if (month == 11) return "December";
  };

  //년, 월 출력
  document.querySelector(
    ".year"
  ).textContent = `${year[0]} ${year[1]} ${year[2]} ${year[3]}`;
  document.querySelector(".month").textContent =
    month < 9 ? `0${month + 1}` : month + 1;
  document.querySelector(".monthtxt").textContent = `${monthtxt()}`;

  //달력에 표시되는 다른 달의 날짜 계산
  let prevDate = new Date(year, month, 0).getDate();
  let prevDay = new Date(year, month, 0).getDay();
  let thisDate = new Date(year, month + 1, 0).getDate();
  let thisDay = new Date(year, month + 1, 0).getDay();

  let prevDates = [];
  let thisDates = [...Array(thisDate + 1).keys()].slice(1);
  let nextDates = [];

  if (prevDay !== 6) {
    for (let i = 0; i < prevDay + 1; i++) {
      prevDates.unshift(prevDate - i);
    }
  }

  for (let i = 1; i < 7 - thisDay; i++) {
    nextDates.push(i);
  }

  let dates = prevDates.concat(thisDates, nextDates);
  const firstDateIndex = dates.indexOf(1);
  const lastDateIndex = dates.lastIndexOf(thisDate);
  dates.forEach((date, i) => {
    //${year}${month}${date}
    let condition;
    if (i < firstDateIndex) condition = "other prev";
    else if (i >= lastDateIndex + 1) condition = "other next";
    else condition = "this";
    dates[i] = `<div class="date"><p class="${condition}">${date}</p></div>`;
  });

  document.querySelector(".dates").innerHTML = dates.join("");

  const today = new Date();
  if (month === today.getMonth() && year == today.getFullYear()) {
    for (let d of document.querySelectorAll(".this")) {
      if (+d.innerText === today.getDate()) {
        d.parentNode.id = "clickDate";
        document.querySelector(
          ".today"
        ).innerHTML = `${today.getDate()}일 (${whatDay(today.getDay())})`;
        break;
      }
    }
  } else {
    document.querySelectorAll(".this")[0].parentNode.id = "clickDate";
    let tempDate = new Date(Date.UTC(year, month, 1));
    document.querySelector(".today").innerHTML = `1일 (${whatDay(
      tempDate.getDay()
    )})`;
  }
  dateDivs = document.querySelectorAll(".date");
  let clickDate = document.getElementById("clickDate");

  dateDivs.forEach((el) =>
    el.addEventListener("click", (event) => {
      if (clickDate != event.currentTarget) {
        event.currentTarget.id = "clickDate";
        clickDate.id = "";
        clickDate = event.currentTarget;
        let tempDate;
        if (event.currentTarget.childNodes[0].className == "other prev") {
          tempDate = new Date(
            Date.UTC(
              year,
              month - 1,
              event.currentTarget.childNodes[0].innerHTML
            )
          );
        } else if (
          event.currentTarget.childNodes[0].className == "other next"
        ) {
          tempDate = new Date(
            Date.UTC(
              year,
              month + 1,
              event.currentTarget.childNodes[0].innerHTML
            )
          );
        } else {
          tempDate = new Date(
            Date.UTC(year, month, event.currentTarget.childNodes[0].innerHTML)
          );
        }
        document.querySelector(
          ".today"
        ).innerHTML = `${tempDate.getDate()}일 (${whatDay(tempDate.getDay())})`;
      }
    })
  );
};

const prevMonth = () => {
  date.setDate(1);
  date.setMonth(date.getMonth() - 1);
  calendar();
};

const nextMonth = () => {
  date.setDate(1);
  date.setMonth(date.getMonth() + 1);
  calendar();
};

const goToday = () => {
  date = new Date();
  calendar();
};

calendar(date);

document.getElementById("start_date").value = new Date()
  .toISOString()
  .substring(0, 10);
document.getElementById("last_date").value = new Date()
  .toISOString()
  .substring(0, 10);

let time = new Date().toISOString().substring(11, 13);
document.getElementById("start_time").value = time + ":00";
document.getElementById("last_time").value =
  parseInt(time) + 1 > 9
    ? parseInt(time) + 1 + ":00"
    : "0" + (parseInt(time) + 1) + ":00";

// 날짜 직접 선택

</script>
  <script src="../js/calendar.js"></script>
</body>

</html>